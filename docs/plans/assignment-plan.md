# План исполнения задания (Systems Theory)

Дата: 2026-02-01

## Цель
Выполнить требования задания из docs/assignment.md с учетом выбранного датасета Dingdong-Inc/FreshRetailNet-50K и текущей архитектуры проекта.

## План работ (по этапам)

### Этап 0. Аудит текущего состояния (быстро)
- Проверить, что модули `src/data_loader.py`, `src/preprocessing.py`, `src/linear_model.py`, `src/nonlinear_model.py`, `src/chaos_metrics.py` содержат каркасы и типовые интерфейсы.
- Уточнить текущие тесты в tests/ и определить, какие из них заглушки.
- Проверить `config/params.yaml` на наличие параметров для моделей.

### Этап 1. Данные и подготовка (TDD)
- **Цель:** материализовать подвыборку из стриминга HF в DataFrame и подготовить длинный ряд (>= 1000 точек).
- Шаги:
  - Написать unit-тесты для `src/data_loader.py`: мокать `load_dataset(..., streaming=True)`.
  - Реализовать фильтр по SKU/Store и сохранение в `data/*.parquet`.
  - Добавить шаг **Heuristic Ranking (Smart Selection)**: просканировать поток (или его часть) и выбрать SKU с
    - высоким объёмом продаж (High Velocity),
    - минимальной разреженностью (Low Sparsity),
    - достаточной вариативностью (не плоский ряд).
  - Написать unit-тесты для `src/preprocessing.py`:
    - корректное `explode` списков `hours_sale` в часовой ряд,
    - обработка `is_stockout` как цензурирование (0 = stockout),
    - базовые пропуски/сглаживание (если предусмотрено).
  - Обеспечить, что итоговый ряд содержит >= 1000 наблюдений.

### Этап 2. Линейная модель ACS (TDD)
- **Цель:** реализовать линейную модель в `src/linear_model.py`.
- Шаги:
  - Тесты на корректность построения `scipy.signal.TransferFunction` и параметризацию.
  - Реализация структурной схемы и общей передаточной функции.
  - Функции анализа устойчивости (корни характеристического уравнения).
  - **Идентификация параметров (System Identification):** оценить параметры передаточной функции (например, $T$ и $K$)
    из данных (автокорреляция, реакция на пополнение/переходные характеристики).

### Этап 3. Нелинейная модель (TDD)
- **Цель:** реализовать ОДУ в `src/nonlinear_model.py`.
- Шаги:
  - Тесты на корректную форму модели и решение через `scipy.integrate.odeint`.
  - Включить температурно-зависимый член распада (decay term).
  - Функции поиска стационарных точек и локальной классификации (узел/фокус/седло/центр).
  - **Идентификация параметров (System Identification):** подогнать параметры ОДУ (скорость распада $k$, параметры спроса)
    через `scipy.optimize.curve_fit` или МНК по реальным данным.

### Этап 4. Хаос-метрики (TDD)
- **Цель:** реализовать Hurst и D2 в `src/chaos_metrics.py`.
- Шаги:
  - Тесты на стабильность расчётов (короткие synthetic серии + проверка диапазонов).
  - Реализация R/S анализа (Hurst) и корреляционной размерности.
  - Интерпретация: стохастичность/хаос/детерминизм.

### Этап 5. Сквозной пайплайн и отчёт
- **Цель:** связать всё через `main.py` и подготовить выводы.
- Шаги:
  - Обновить `main.py` для последовательного запуска: загрузка → препроцессинг → модели → метрики.
  - Интегрировать `src/visualization.py` в пайплайн и генерировать артефакты для отчёта:
    - Этап 2: переходная характеристика (Step Response) и карта полюсов/нулей (Pole-Zero map).
    - Этап 3: фазовый портрет (Phase Portrait: $x$ vs $dx/dt$).
    - Этап 4: график наклона для R/S (Hurst plot) и $log(C(r))$ vs $log(r)$ для $D_2$.
  - Зафиксировать параметры в `config/params.yaml`.
  - Обновить `docs/reports/devlog.md` по этапам.
  - Подготовить структуру итогового отчёта (PDF) в docs/ (если появится шаблон).

## Артефакты и места в коде
- Модули: src/data_loader.py, src/preprocessing.py, src/linear_model.py, src/nonlinear_model.py, src/chaos_metrics.py
- Тесты: tests/test_data_loader.py, tests/test_preprocessing.py, tests/test_models.py, tests/test_chaos.py
- Параметры: config/params.yaml
- Логи: docs/reports/devlog.md
- Отчёт: docs/ (будет добавлен при готовности)

## Готовность / критерии приёмки
- Воспроизводимый запуск: `python main.py` (в conda env `tsi`).
- Все тесты проходят: `pytest tests/`.
- Из данных сформирован ряд >= 1000 точек.
- Реализованы и проверены: передаточная функция, устойчивость, ОДУ, стационарные точки, Hurst, D2.
- Обновлён devlog по факту выполнения этапов.
